# 掼蛋组牌评分系统 技术架构文档 v1.1 修订稿

基线版本：v1.0（日期：2026年2月15日）

## 1. 必改勘误清单

1. 名称统一：全文将“掂蛋”统一为“掼蛋”。
2. 规则数据修正：红桃级牌（逢人配）数量由“共22张”修正为“共2张”。
3. 目录修正：补齐“4. 交互设计”，并将“10. 附录”修正为“10. 局限性与潜在风险”“11. 附录”。
4. 轮次修正闭合：明确 9-10 手为 0 分，<=8 手递增，>=11 手递减，消除边界歧义。
5. 搜索策略统一：Web Worker 设为默认执行路径，不再写成“可选”。
6. 版本范围统一：`贪心降级` 定义为 v1.0 已纳入能力，从“未纳入 v1.0”列表移除。
7. 数据结构补齐：新增 `aiScoreDetail` 字段，支撑“总分及各分项对比”展示与历史回放。
8. 排版勘误：修正“7.5性能目、标”“6.5云端升级触发条件”等格式问题。

## 2. 可直接替换原文

### 2.1 基础信息（替换 2.1）

- 两副扑克牌，共108张（含4张王）
- 每人27张
- “打几”范围：2→3→...→K→A，共13级
- 红桃级牌为逢人配（万能牌），每副1张，共2张

### 3.6 轮次修正分（替换 3.6）

以实战效率为导向的修正，设组牌总手数为 `H`：

- 当 `H <= 8`：轮次修正分 = `+2 * (9 - H)`
- 当 `9 <= H <= 10`：轮次修正分 = `0`
- 当 `H >= 11`：轮次修正分 = `-2 * (H - 10)`

示例：

- `H = 8`，修正 `+2`
- `H = 10`，修正 `0`
- `H = 12`，修正 `-4`

### 6.2 数据结构（替换字段清单）

每局对战记录包含以下字段：

- `id: string` 唯一标识
- `timestamp: number` 对局时间戳
- `trumpRank: string` 当前“打几”
- `dealtCards: array` 发到的27张牌
- `userCombos: array` 用户的组牌方案
- `userScore: number` 用户方案得分
- `userScoreDetail: object` 用户方案分项得分明细
- `aiCombos: array` AI最优组牌方案
- `aiScore: number` AI方案得分
- `aiScoreDetail: object` AI方案分项得分明细
- `isOptimal: boolean` 用户是否达到最优解

### 7.3-7.5 AI 搜索与性能（替换 7.3、7.4、7.5）

#### 7.3 贪心降级与超时机制

- 搜索流程：`0-3秒` 执行 `DFS + 剪枝`。
- 超时策略：超过 `3秒` 强制返回“当前已找到的最高分方案”（较优解）。
- UI文案分级：
  - 未超时：展示“AI最优方案”
  - 超时：展示“AI较优方案”，并提示“计算超时，本结果可能不是全局最优”

#### 7.4 性能优化

- 搜索计算统一在 `Web Worker` 中执行，主线程仅负责渲染与交互。
- 目的：避免页面卡顿，保证点选和动画反馈流畅。

#### 7.5 性能目标

- 目标：普通手机浏览器中，绝大多数牌局在 `3秒` 内返回结果。
- 极端复杂牌局触发超时降级时，仍需在用户可接受时延内返回“AI较优方案”。

### 9.1 v1.0 MVP（替换 9.1 中 AI 条目）

- AI最优方案搜索与差异解释（含 `3秒超时降级`、视觉差异对比展示）

### 11.1 未纳入 v1.0 概念（替换该小节末尾）

从本节移除“贪心降级”条目。  
说明：`贪心降级` 已纳入 `v1.0`，属于正式交付能力。

### 目录（替换目录）

1. 项目概述
2. 规则引擎
3. 静态评分体系
4. 交互设计
5. 技术方案
6. 数据存储方案
7. AI最优方案搜索
8. 统计分析模块
9. 版本规划
10. 局限性与潜在风险
11. 附录

## 3. 全文批量替换建议

1. `掂蛋` -> `掼蛋`
2. `7.5性能目、标` -> `7.5 性能目标`
3. `6.5云端升级触发条件` -> `6.5 云端升级触发条件`

